---
title: "paper"
author: "Chay Park"
date: 22 January 2024
format: pdf
editor: visual
---

```{r}
#### Preamble ####
# Purpose: Read in data from the Toronto Police Annual Report - Victims of Crimes and provide relevant tables and graphs of the dataset.
# Author: Chay Park
# Email: chay.park@mail.utoronto.ca
# Date: Jan 22, 2024
# Prerequisites: Need to know where to get Toronto Police Annual Report - Victims of Crimes
```

# Abstract

### top-level finding, what is the one thing that we learn about the world because of this paper?

Often we see crimes on the global news and majority is happening in the States. Canada is known to be relatively safe country around the world. Toronto is one of the biggest city in Canada and thus the most populated. By investigating the dataset from Toronto Police Services, this report demonstrate the top three crimes reported over the year from 2014 to 2022.

# Introduction

Why I deal with this data? General trends of victims reporting following crimes, robbery, assault, sexual violation. Tables and graphs support visualize the trends over the year. From the dataset, we want to find out whether there are any point outlining from the trend between sexes, age_group, year. Then draw a correlation between other factor such as global pandemic.

Impact of pandemic on reporting crimes,

This paper use R to analyze a dataset from opendatatoronto. This dataset includes all identified victims of crimes against the person, including, but not limited to, those that may have been deemed unfounded after investigation, those that may have occurred outside the City of Toronto limits, or have no verified location. The paper extract age group, count, sex, subtype of crimes, report year.

Visualize trend among the sex, age group per crime. The tendency of male not reporting might skew the result.

# Data

The unknown values for age_group, age_cohort, sex are excluded as they do not contribute to define data groups explicitly. The data set does not offer explicit details about the unknown values. Similarly, the other crime is not included in the cleaned_data set due to its uncertainty. Thus, the cleaned_data only serve top three reported crimes; robbery, assault, and sexual violation. Moreover, the sex is divided into two, female and male. Age group has three subgroups, adult, youth, child.

```{r}
# Install the necessary packages if not already installed
# install.packages(c("opendatatoronto", "knitr", "lubridate", "tidyverse"))

# Load required libraries
library(dplyr)
library(knitr)
library(lubridate)
library(tidyverse)

# Filter out unknown values for SEX and rows with 'other' values for SUBTYPE
cleaned_data <- unedited_data %>%
  filter(SEX %in% c("M", "F") & AGE_GROUP != "Unknown" & SUBTYPE != "Other")

head(cleaned_data)
```

The table below showcases the general trend on the number of victims in different age group. Age information is based on the year that crime was reported. Adult is considered the group at an age of 18 or older. The age of the youth group is between 12 to 17. Below 12 is considered the child group.

```{r}
#### Table 1a ####
# Count the Child group victims, Youth group victims, Adult group victims over the year from 2014 to 2022
####  ####

# Load required libraries
library(dplyr)
library(knitr)
library(lubridate)
library(tidyverse)

# Filter rows with Adult, Child, and Youth in AGE_GROUP
filtered_data <- cleaned_data %>%
  filter(AGE_GROUP %in% c("Adult", "Child", "Youth"))

# Create a new column for Age Cohort based on Age Group
filtered_data <- filtered_data %>%
  mutate(Age_Cohort = case_when(
    AGE_GROUP == "Child" ~ "Child",
    AGE_GROUP == "Adult" ~ "Adult",
    AGE_GROUP == "Youth" ~ "Youth",
    TRUE ~ "Other"  # Include an "Other" category for any unexpected values
  ))

# Filter data for the years 2014 to 2022
filtered_data <- filtered_data %>%
  filter(REPORT_YEAR >= 2014 & REPORT_YEAR <= 2022)

# Create a table counting the number of victims for each Age Cohort over the years
age_cohort_table <- filtered_data %>%
  group_by(REPORT_YEAR, Age_Cohort) %>%
  summarise(Victims_Count = sum(COUNT_))

# Pivot the data to have Adult, Youth, Child as columns in that order
pivoted_table <- age_cohort_table %>%
  pivot_wider(names_from = Age_Cohort, values_from = Victims_Count, values_fill = 0, 
              values_fn = list(Victims_Count = sum)) %>%
  select(REPORT_YEAR, Adult, Youth, Child)

# Print the table using knitr
kable(pivoted_table, format = "markdown", caption = "Total number of victims in different age group from 2014 to 2022")


```

Table 1a counts the total number of victims for each age group over the years. It is obvious to find out that Adult victim group is reported the most and the Child victim group is reported the least. Also, it is noticeable that in 2020, the reported number of victims are far less than the other years. In three different age group, crime reporting rate significantly reduced by the impact of COVID and its lockdown.

```{r}
#### Bar graph 1a ####
# Bar graph 1a illustrates the number of reported crimes in different age group over the year from 2014 to 2022. 
#### ####

# Load required libraries
library(dplyr)
library(ggplot2)

# Refer to the pivoted table from table 1a

# Create bar graphs for each age group
bar_plot <- ggplot(pivoted_table, aes(x = REPORT_YEAR)) +
  geom_bar(aes(y = Adult, fill = "Adult"), stat = "identity", position = "stack") +
  geom_bar(aes(y = Youth, fill = "Youth"), stat = "identity", position = "stack") +
  geom_bar(aes(y = Child, fill = "Child"), stat = "identity", position = "stack") +
  labs(title = "Number of Reported Victims of Crimes in Different Age Group Over the Years",
       x = "Year",
       y = "Number of reported crimes") +
  scale_fill_manual(values = c(Adult = "blue", Youth = "green", Child = "orange"),
                    name = "Age Group") +
  theme_minimal() +
  scale_x_continuous(breaks = seq(2014, 2022, by = 1))

# Print the bar plot
print(bar_plot)

```

Bar graph 1a refers table 1a. By visualizing the age group into a bar per year, it is clear to see that majority of victims of reported crimes are adult. Also, the bars are showing ascending order from the year 2014 to 2018 but the reported crimes significantly drop between 2019 and 2020. One possible reason is because of COVID.

```{r}
# Load required libraries
library(dplyr)
library(knitr)
library(lubridate)
library(tidyverse)

# Filter data for the years 2014 to 2022
filtered_data <- cleaned_data %>%
  filter(REPORT_YEAR >= 2014 & REPORT_YEAR <= 2022)

# Create a table counting the number of victims for each crime subtype over the years
crime_subtype_table <- filtered_data %>%
  group_by(REPORT_YEAR, SUBTYPE) %>%
  summarise(Victims_Count = sum(COUNT_))

# Pivot the data to have Assault, Sexual Violation, Robbery as columns
pivoted_table2 <- crime_subtype_table %>%
  pivot_wider(names_from = SUBTYPE, values_from = Victims_Count, values_fill = 0)

# Print the table using knitr
kable(pivoted_table2, format = "markdown", caption = "Table for Victims Count by Crime Subtype Over the Years")


```

```{r}
# Load required libraries
library(dplyr)
library(ggplot2)

# Assuming 'pivoted_table2' is the table with Assault, Sexual Violation, Robbery columns from the above table code

# Create bar graphs for each crime subtype
bar_plot <- ggplot(pivoted_table2, aes(x = REPORT_YEAR)) +
  geom_bar(aes(y = Assault, fill = "Assault"), stat = "identity", position = "stack") +
  geom_bar(aes(y = `Sexual Violation`, fill = "Sexual Violation"), stat = "identity", position = "stack") +
  geom_bar(aes(y = Robbery, fill = "Robbery"), stat = "identity", position = "stack") +
  labs(title = "Victims Count by Crime Subtype Over the Years",
       x = "Year",
       y = "Number of Reported Victims of Crimes") +
  scale_fill_manual(values = c("Assault" = "grey", "Sexual Violation" = "brown", "Robbery" = "pink"),
                    name = "Crime Subtype") +
  theme_minimal() +
  scale_x_continuous(breaks = seq(2014, 2022, by = 1))

# Print the bar plot
print(bar_plot)

```

```{r}
# Load required libraries
library(dplyr)
library(ggplot2)

# Assuming 'crime_counts' is the data frame with relevant columns

# Filter the data for Sexual Violation
sexual_violation_data <- cleaned_data %>%
  filter(SUBTYPE == "Sexual Violation")

# Create a bar graph for Sexual Violation with groups for AGE_GROUP
bar_plot <- ggplot(sexual_violation_data, aes(x = REPORT_YEAR, y = COUNT_, fill = AGE_GROUP)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Victims Count of Sexual Violation by Age Group Over the Years",
       x = "Year",
       y = "Number of Reported Victims of Sexual Violation",
       fill = "Age Group") +
  theme_minimal() +
  scale_x_continuous(breaks = seq(min(sexual_violation_data$REPORT_YEAR), max(sexual_violation_data$REPORT_YEAR), by = 1)) +
  scale_fill_manual(values = c("Child" = "yellow", "Youth" = "orange", "Adult" = "skyblue"))

# Print the bar plot
print(bar_plot)
```

# References

### should be added using BibTeX, reference R and any R pckgs you use, as well as the dataset.

Gelfand, Sharla. 2020. *Opendatatoronto : Access the City of Toronto Open Data Portal*

R Core Team. 2020. *R: A Language and Environment for Statistical Computing.* Vienna, Austria: R Foundation for Statistical Computing. https://www.R-project.org/.

Toronto Police Services. 2023. *TPS Police Annual Statistical Report - Victims of Crimes*

Wickham, Hadley, Mara Averick, Jennifer Bryan, Winston Chang, Lucy D'Agostino McGowan, Romain François, Garrett Grolemund, et al. 2019. "Welcome to the tidyverse." *Journal of Open Source Software* 4 (43): 1686. https://doi.org/10.21105/joss.01686.

\
Wickham, Hadley, Romain François, Lionel Henry, and Kirill Müller. 2021. *Dplyr: A Grammar of Data Manipulation.*https://CRAN.R-project.org/package=dplyr.

Xie, Yihui. 2014. "Knitr: A Comprehensive Tool for Reproducible Research in R." *In Implementing Reproducible Computational Research*, edited by Victoria Stodden, Friedrich Leisch, and Roger D. Peng. Chapman; Hall/CRC. http://www.crcpress.com/product/isbn/9781466561595.
