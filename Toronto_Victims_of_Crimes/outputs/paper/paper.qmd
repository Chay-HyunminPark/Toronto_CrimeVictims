---
title: "paper"
author: "Chay Park"
date: today
format: pdf
editor: visual
bibliography: references.bib
prefer-html: true
---

```{r}
#| echo: false
#| eval: true
#| warning: false
#| message: false
#| include: false

#### Preamble ####
# Purpose: Read in data from the Toronto Police Annual Report - Victims of Crimes and provide relevant tables and graphs of the dataset.
# Author: Chay Park
# Email: chay.park@mail.utoronto.ca
# Date: Jan 22, 2024
# Prerequisites: Need to know where to get Toronto Police Annual Report - Victims of Crimes
```

# Abstract

### top-level finding, what is the one thing that we learn about the world because of this paper?

Often we see crimes on the global news and majority is happening in the States. Canada is known to be relatively safe country around the world. Toronto is one of the biggest city in Canada and thus the most populated. By investigating the dataset from Toronto Police Services, this report demonstrate the top three crimes reported over the year from 2014 to 2022.

# Introduction

Why I deal with this data? General trends of victims reporting following crimes, robbery, assault, sexual violation. Tables and graphs support visualize the trends over the year. From the dataset, we want to find out whether there are any point outlining from the trend between sexes, age_group, year. Then draw a correlation between other factor such as global pandemic.

Impact of pandemic on reporting crimes,

This paper use R to analyze a dataset from opendatatoronto. This dataset includes all identified victims of crimes against the person, including, but not limited to, those that may have been deemed unfounded after investigation, those that may have occurred outside the City of Toronto limits, or have no verified location. The paper extract age group, count, sex, subtype of crimes, report year.

Visualize trend among the sex, age group per crime. The tendency of male not reporting might skew the result.

# Data

The unknown values for age_group, age_cohort, sex are excluded as they do not contribute to define data groups explicitly. The data set does not offer explicit details about the unknown values. Similarly, the other crime is not included in the cleaned_data set due to its uncertainty. Thus, the cleaned_data only serve top three reported crimes; robbery, assault, and sexual violation. Moreover, the sex is divided into two, female and male. Age group has three subgroups, adult, youth, child.

The table (@tbl-totalsum-table) below showcases the general trend on the number of victims in different age group. Age information is based on the year that crime was reported. Adult is considered the group at an age of 18 or older. The age of the youth group is between 12 to 17. Below 12 is considered the child group.

```{r}
#| echo: false
#| eval: true
#| warning: false
#| message: false
#| label: tbl-totalsum-table
#| tbl-cap: "Total sum of victims in different age group throughout the years"

#### Table 1a ####
# Count the Child group victims, Youth group victims, Adult group victims over the year from 2014 to 2022
####  ####

# Install the necessary packages if not already installed
install.packages(c("opendatatoronto", "knitr", "lubridate", "tidyverse", "kableExtra"))

# Load required libraries
library(dplyr)
library(knitr)
library(lubridate)
library(tidyverse)
library(kableExtra)

# Load the csv file
cleaned_data <- read_csv(file = here::here("Toronto_Victims_of_Crimes/inputs/data/cleaned_data.csv"))

# Filter rows with Adult, Child, and Youth in AGE_GROUP
filtered_data <- cleaned_data %>%
  filter(AGE_GROUP %in% c("Adult", "Child", "Youth"))

# Create a new column for Age Cohort based on Age Group
filtered_data <- filtered_data %>%
  mutate(Age_Cohort = case_when(
    AGE_GROUP == "Child" ~ "Child",
    AGE_GROUP == "Adult" ~ "Adult",
    AGE_GROUP == "Youth" ~ "Youth",
    TRUE ~ "Other"  # Include an "Other" category for any unexpected values
  ))

# Filter data for the years 2014 to 2022
filtered_data <- filtered_data %>%
  filter(REPORT_YEAR >= 2014 & REPORT_YEAR <= 2022)

# Create a table counting the number of victims for each Age Cohort over the years
age_cohort_table <- filtered_data %>%
  group_by(REPORT_YEAR, Age_Cohort) %>%
  summarise(Victims_Count = sum(COUNT_))

# Pivot the data to have Adult, Youth, Child as columns in that order
pivoted_table <- age_cohort_table %>%
  pivot_wider(names_from = Age_Cohort, values_from = Victims_Count, values_fill = 0, 
              values_fn = list(Victims_Count = sum)) %>%
  select(REPORT_YEAR, Adult, Youth, Child)

# Print the table with additional styling
kable(pivoted_table, caption = "Count of Child, Youth, and Adult group victims over the years from 2014 to 2022", format = "html") %>%
  kable_styling(full_width = FALSE) %>%
  add_header_above(c(" ", "Victims Count" = 3))

```

Table 1a (@tbl-totalsum-table) counts the total number of victims for each age group over the years. It is obvious to find out that Adult victim group is reported the most and the Child victim group is reported the least. Also, it is noticeable that in 2020, the reported number of victims are far less than the other years. In three different age group, crime reporting rate significantly reduced by the impact of COVID and its lockdown.

```{r}
#| echo: false
#| eval: true
#| warning: false
#| message: false
#| label: fig-totalsum-graph
#| fig-cap: "Number of Reported Victims of Crimes in Different Age Group Over the Years"

#### Bar graph 1a ####
# Bar graph 1a illustrates the number of reported crimes in different age group over the year from 2014 to 2022. 
#### ####

# Load required libraries
library(dplyr)
library(ggplot2)

# Refer to the pivoted table from table 1a

# Create bar graphs for each age group
bar_plot <- ggplot(pivoted_table, aes(x = REPORT_YEAR)) +
  geom_bar(aes(y = Adult, fill = "Adult"), stat = "identity", position = "stack") +
  geom_bar(aes(y = Youth, fill = "Youth"), stat = "identity", position = "stack") +
  geom_bar(aes(y = Child, fill = "Child"), stat = "identity", position = "stack") +
  labs(x = "Year",
       y = "Number of reported crimes") +
  scale_fill_manual(values = c(Adult = "skyblue", Youth = "orange", Child = "pink"),
                    name = "Age Group") +
  theme_minimal() +
  scale_x_continuous(breaks = seq(2014, 2022, by = 1))

# Print the bar plot
print(bar_plot)

```

Bar graph (@fig-totalsum-graph) refers table (@tbl-totalsum-table). By visualizing the age group into a bar per year, it is clear to see that majority of victims of reported crimes are adult. Also, the bars are showing ascending order from the year 2014 to 2018 but the reported crimes significantly drop between 2019 and 2020. One possible reason is because of COVID. Correlation between COVID pandemic and report crime rates 논문 찾아서 첨부

```{r}
#| echo: false
#| eval: true
#| warning: false
#| message: false
#| label: fig-sv-graph
#| fig-cap: "Victims Count of Sexual Violation by Age Group Over the Years"

# Load required libraries
library(dplyr)
library(ggplot2)

# Load the csv file
cleaned_data <- read_csv(file = here::here("Toronto_Victims_of_Crimes/inputs/data/cleaned_data.csv"))

# Filter the data for Sexual Violation
sexual_violation_data <- cleaned_data %>%
  filter(SUBTYPE == "Sexual Violation")

# Create a bar graph for Sexual Violation with groups for AGE_GROUP
bar_plot <- ggplot(sexual_violation_data, aes(x = REPORT_YEAR, y = COUNT_, fill = AGE_GROUP)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(x = "Year",
       y = "Number of Reported Victims of Sexual Violation",
       fill = "Age Group") +
  theme_minimal() +
  scale_x_continuous(breaks = seq(min(sexual_violation_data$REPORT_YEAR), max(sexual_violation_data$REPORT_YEAR), by = 1)) +
  scale_fill_manual(values = c("Child" = "pink", "Youth" = "orange", "Adult" = "skyblue"))

# Print the bar plot
print(bar_plot)
```

From 2014 to 2020 (@fig-sv-graph), the trend shows that the adult group is twice the size of the child group. Up until 2020, victims of sexual violation was predominantly adult age group. However, as of 2021, the youth victim group surpass the amount of the adult victim group. 무슨 사건이 일어났을까? 왜 youth group이 더 높아졌는지 사유 찾기

```{r}
#| echo: false
#| eval: true
#| warning: false
#| message: false
#| label: fig-a-graph
#| fig-cap: "Victims Count of Assault by Age Group Over the Years"

# Load required libraries
library(dplyr)
library(ggplot2)

# Load the csv file
cleaned_data <- read_csv(file = here::here("Toronto_Victims_of_Crimes/inputs/data/cleaned_data.csv"))

# Filter the data for Assault
assault_data <- cleaned_data %>%
  filter(SUBTYPE == "Assault")

# Create a bar graph for Assault with groups for AGE_GROUP
bar_plot <- ggplot(assault_data, aes(x = REPORT_YEAR, y = COUNT_, fill = AGE_GROUP)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(x = "Year",
       y = "Number of Reported Victims of Assault",
       fill = "Age Group") +
  theme_minimal() +
  scale_x_continuous(breaks = seq(min(assault_data$REPORT_YEAR), max(assault_data$REPORT_YEAR), by = 1)) +
  scale_fill_manual(values = c("Child" = "pink", "Youth" = "orange", "Adult" = "skyblue"))

# Print the bar plot
print(bar_plot)
```

The graph (@fig-a-graph) illustrates the ascending trend in number of victims of assault in city of Toronto over the year from 2014 to 2022. COVID does not seem to be a factor that skews the trend. Though, size of both child and youth victim groups got halved. Compared to child victim group, size of youth victim group grows fast.

```{r}
#| echo: false
#| eval: true
#| warning: false
#| message: false
#| label: fig-r-graph
#| fig-cap: "Victims Count of Robbery by Age Group Over the Years"

# Load required libraries
library(dplyr)
library(ggplot2)

# Load the csv file
cleaned_data <- read_csv(file = here::here("Toronto_Victims_of_Crimes/inputs/data/cleaned_data.csv"))

# Filter the data for Robbery
robbery_data <- cleaned_data %>%
  filter(SUBTYPE == "Robbery")

# Create a bar graph for Robbery with groups for AGE_GROUP
bar_plot <- ggplot(robbery_data, aes(x = REPORT_YEAR, y = COUNT_, fill = AGE_GROUP)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(x = "Year",
       y = "Number of Reported Victims of Robbery",
       fill = "Age Group") +
  theme_minimal() +
  scale_x_continuous(breaks = seq(min(robbery_data$REPORT_YEAR), max(robbery_data$REPORT_YEAR), by = 1)) +
  scale_fill_manual(values = c("Child" = "pink", "Youth" = "orange", "Adult" = "skyblue"))

# Print the bar plot
print(bar_plot)
```

Graph (@fig-r-graph) depicts that as of 2018, youth group of victims of robbery diminished and it keeps at the lower level. COVID pandemic is the factor of bar graphs on the number of victim of robbery in different age group over the year. In 2020, victims of robbery in every age group significantly decreased. We could assume that lockdown mandate affect the decrease in victims.

```{r}
#| echo: false
#| eval: true
#| warning: false
#| message: false
#| label: tbl-crimetype-table
#| tbl-cap: "Total number of victims counted for each crime from the year 2014 to 2022"

# Load required libraries
library(dplyr)
library(knitr)
library(lubridate)
library(tidyverse)
library(kableExtra)

# Load the csv file
cleaned_data <- read_csv(file = here::here("Toronto_Victims_of_Crimes/inputs/data/cleaned_data.csv"))

# Filter data for the years 2014 to 2022
filtered_data <- cleaned_data %>%
  filter(REPORT_YEAR >= 2014 & REPORT_YEAR <= 2022)

# Create a table counting the number of victims for each crime subtype over the years
crime_subtype_table <- filtered_data %>%
  group_by(REPORT_YEAR, SUBTYPE) %>%
  summarise(Victims_Count = sum(COUNT_))

# Pivot the data to have Assault, Sexual Violation, Robbery as columns
pivoted_table_2 <- crime_subtype_table %>%
  pivot_wider(names_from = SUBTYPE, values_from = Victims_Count, values_fill = 0)

# Print the table using kable with additional styling
kable(pivoted_table_2, caption = "Total number of victims counted for each crime from the year 2014 to 2022", format = "html") %>%
  kable_styling(full_width = FALSE) %>%
  add_header_above(c(" ", "Victims Count" = 3))

```

# References

---
nocite: '@*'
---
